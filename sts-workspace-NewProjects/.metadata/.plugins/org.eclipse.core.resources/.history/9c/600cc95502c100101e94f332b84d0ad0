package com.camdrilee.service;

import java.sql.Timestamp;
import java.util.UUID;

import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.UpdateTimestamp;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import com.camdrilee.entity.CategoryEntity;
import com.camdrilee.entity.ItemEntity;
import com.camdrilee.io.ItemRequest;
import com.camdrilee.repository.CategoryRepository;
import com.camdrilee.repository.ItemRepository;

import jakarta.persistence.Column;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.ManyToOne;

@Service
public class ItemService {

    private final FileUploadService fileUploadService;
	
	@Autowired
	private ItemRepository itemRepo;
	@Autowired
	private CategoryRepository catRepo;
	@Autowired
	private FileUploadService fileUpload;

    ItemService(FileUploadService fileUploadService) {
        this.fileUploadService = fileUploadService;
    }
	
	public void addItem(ItemRequest itemReq,MultipartFile file) {
		ItemEntity newItem = convertToEntity(itemReq);
		String imgUrl = fileUpload.uploadFile(file);
		newItem.setImgUrl(imgUrl);
		itemRepo.save(newItem);
	}

	private ItemEntity convertToEntity(ItemRequest itemReq) {
		ItemEntity.builder()
		.itemId(UUID.randomUUID().toString())
		.itemName(itemReq.getItemName())
		.price(itemReq.getPrice())
		.description(itemReq.getDescription())
		.catEntity(catRepo.findByCatId(itemReq.getCatId()).orElseThrow(()->new RuntimeException("Category not found")))
		.build();
		return null;
	}
	@Column(unique = true)
	private String itemId;
	private String imgUrl;
	private String itemName;
	private double price;
	@ManyToOne
	@JoinColumn(name = "catId")
	private CategoryEntity catEntity;
	private String description;
	@CreationTimestamp
	@Column(updatable = false)
	private Timestamp updatedAt;
	@UpdateTimestamp
	private Timestamp createdAt;

	public void deleteItem() {

	}

	public void listItem() {

	}
}
