package com.camdrilee.service;

import java.sql.Timestamp;
import java.util.UUID;

import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.UpdateTimestamp;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import com.camdrilee.entity.CategoryEntity;
import com.camdrilee.entity.ItemEntity;
import com.camdrilee.io.ItemRequest;
import com.camdrilee.io.ItemResponse;
import com.camdrilee.repository.CategoryRepository;
import com.camdrilee.repository.ItemRepository;

import jakarta.persistence.Column;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.ManyToOne;

@Service
public class ItemService {

    private final FileUploadService fileUploadService;
	
	@Autowired
	private ItemRepository itemRepo;
	@Autowired
	private CategoryRepository catRepo;
	@Autowired
	private FileUploadService fileUpload;

    ItemService(FileUploadService fileUploadService) {
        this.fileUploadService = fileUploadService;
    }
	
	public ItemResponse addItem(ItemRequest itemReq,MultipartFile file) {
		ItemEntity newItem = convertToEntity(itemReq);
		String imgUrl = fileUpload.uploadFile(file);
		newItem.setImgUrl(imgUrl);
		itemRepo.save(newItem);
		return convertToItemRes(newItem);
	}

	private ItemResponse convertToCatRes(ItemEntity newItem) {
		return ItemResponse.builder()
			.itemId(newItem.getItemId())
			.itemName(newItem.getItemName())
			.price(newItem.getPrice())
			.catEntity(newItem.getCatEntity())
			.description(newItem.getDescription())
			.createdAt(newItem.getCreatedAt())
			.updatedAt(newItem.getUpdatedAt())
			.build();
	}

	private ItemEntity convertToEntity(ItemRequest itemReq) {
		ItemEntity.builder()
		.itemId(UUID.randomUUID().toString())
		.itemName(itemReq.getItemName())
		.price(itemReq.getPrice())
		.description(itemReq.getDescription())
		.catEntity(catRepo.findByCatId(itemReq.getCatId()).orElseThrow(()->new RuntimeException("Category not found")))
		.build();
		return null;
	}
	
	public void deleteItem() {

	}

	public void listItem() {

	}
}
