package com.camdrilee.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.BadCredentialsException;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.stereotype.Service;

import com.camdrilee.entity.UserEntity;
import com.camdrilee.io.AuthRequest;
import com.camdrilee.io.AuthResponse;
import com.camdrilee.repository.ItemRepository;
import com.camdrilee.repository.UserRepository;
import com.camdrilee.util.JwtUtil;

@Service
public class AuthService {

    private final ItemRepository itemRepository;
	@Autowired
	private AuthenticationManager authenticationManager;
	@Autowired
	private AppUserDetailsService appUserDetailsService;
	@Autowired
	private JwtUtil jwtUtil;
	@Autowired
	private UserRepository userRepository;

	
	public String getRole(String email){
		UserEntity existedUser = userRepository.findByEmail(email).orElseThrow(()->new RuntimeException("Email not found"));
		return existedUser.getRole();
	}
	
	
	public AuthResponse login(AuthRequest request) {
		authenticate(request.getEmail(),request.getPassword());
		UserDetails userDetails = appUserDetailsService.loadUserByUsername(request.getEmail());
		String token = jwtUtil.generateToken(userDetails);
		AuthResponse(request.getEmail(),userDetails.getro)
	}

	private void authenticate(String email, String password) {
		try {
			authenticationManager.authenticate(new UsernamePasswordAuthenticationToken(email, password));
		} catch (BadCredentialsException e) {
			throw new RuntimeException("User denied!");
		}
	}
}
